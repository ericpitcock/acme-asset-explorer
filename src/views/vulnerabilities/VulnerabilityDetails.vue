<template>
  <div class="vulnerabilities">
    <ep-header v-bind="commonPageHeaderProps">
      <template #left>
        <h1>
          <span><router-link
              class="text--link"
              to="/vulnerabilities"
            >Vulnerabilities</router-link></span>
          <span>/</span>
          <span>{{ vulnerability.id }}</span>
        </h1>
      </template>
    </ep-header>
    <in-sidebar-layout sidebar-padding="2rem 0 0 3rem">
      <template #sidebar>
        sidebar
      </template>
      <template #content>
        <ep-container
          v-bind="commonContainerProps"
          content-padding="3rem 0 1rem 0"
        >
          <p>{{ vulnerability.id }}</p>
          <p>{{ vulnerability.published_date }}</p>
          <p>{{ vulnerability.last_modified_date }}</p>
          <p>{{ vulnerability.date_seen }}</p>
          <p>{{ vulnerability.severity.value }}</p>
          <p>{{ vulnerability.base_score }}</p>
          <p>{{ vulnerability.description }}</p>
          <p>{{ vulnerability.affected_assets }}</p>
          <!-- {{ vulnerability }} -->
        </ep-container>
        <ep-container
          v-bind="commonContainerProps"
          content-padding="3rem 0 1rem 0"
        >
          Affected assets
          <ep-table
            :data="assetDataRef"
            v-bind="tableProps"
          />
        </ep-container>
      </template>
    </in-sidebar-layout>
  </div>
</template>

<script setup>
  import { computed, ref } from 'vue'
  import { useStore } from 'vuex'
  import { assetColumns, assetData } from '../../store/assetData.js'
  import InSidebarLayout from '@/layouts/InSidebarLayout.vue'

  const store = useStore()
  const commonPageHeaderProps = store.state.commonProps.commonPageHeaderProps
  const commonContainerProps = computed(() => store.state.commonProps.commonContainerProps)

  const vulnerability = computed(() => store.state.selectedVulnerability)

  const assetDataRef = ref(assetData)

  const tableProps = {
    columns: assetColumns,
    bordered: true,
    exclude: ['id', 'status', 'vulnerabilities', 'ipv6_address', 'mac_address', 'operating_system'],
    headerBackgroundColor: 'var(--interface-surface)',
    searchable: true,
    selectable: true,
    stickyHeader: true,
    stickyTop: '61',
    striped: true,
    sortDir: 'asc',
    sortable: true,
    width: '100%',
  }

  // get 21 random assets from assetData
  // assetDataRef.value = assetDataRef.value.sort(() => Math.random() - 0.5).slice(0, 11).filter((asset) => asset.operating_system === 'Windows')

  // 10-13 random assets with operating_system === 'Windows' from assetData
  assetDataRef.value = assetDataRef.value
    .filter((asset) => asset.operating_system === 'Windows')
    // filter to active only
    .filter((asset) => asset.status.value === 'Active')


</script>

<style lang="scss" scoped>
  h1 {
    display: flex;
    gap: 1rem;
  }
</style>